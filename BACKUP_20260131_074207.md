# Database Backup - January 31, 2026 07:42:07

## Backup Information

**Backup Date:** 2026-01-31 07:42:07
**Migration Reference Point:** `096_simplify_force_delete_dues_function`
**Purpose:** Pre-modification backup before FiscalPeriods.tsx changes

## What's Included in This Backup

This backup captures the complete database state at migration 096, including:

### Tables (18 total)
- accounts
- app_translations
- balance_transfers
- budget_categories
- category_templates
- debt_workflows
- dues
- fiscal_periods
- ledger_entries
- payments
- penalty_settings
- profiles
- role_permissions
- sites
- support_tickets
- unit_types
- units
- user_site_roles

### Views (5 total)
- debt_alerts
- site_financial_summary
- transparency_report
- unit_balances
- unit_balances_from_ledger

### Functions (31 total)
Including key functions like:
- `admin_force_delete_dues` (simplified version from migration 096)
- `apply_unit_payment`
- `set_unit_monthly_due`
- `set_all_units_monthly_due`
- `set_varied_unit_monthly_dues`
- `generate_fiscal_period_dues`
- And 25+ other critical functions

### Triggers (16 total)
All automatic triggers for:
- Account balance updates
- Budget tracking
- Ledger entry creation
- Payment processing
- Due reversal on deletions

## How to Restore This Backup

### Option 1: Rollback to Migration 096 (Recommended)

If you've applied migrations beyond 096 and want to return to this state:

```bash
# This will rollback to migration 096
# WARNING: This will LOSE any data changes made after this migration
supabase db reset
supabase migration up --to 20260131072503
```

### Option 2: Re-run All Migrations from Scratch

To completely reset your database and rebuild from migration 001:

```bash
# WARNING: This will DELETE ALL DATA and rebuild from scratch
supabase db reset
```

### Option 3: Manual Restoration (Advanced)

If you need selective restoration:

1. **Restore a specific function:**
   - Find the migration file that created/modified the function
   - Copy the CREATE OR REPLACE FUNCTION statement
   - Run it in the Supabase SQL Editor

2. **Restore table structure:**
   - Review the schema in migration files 001-096
   - Apply necessary CREATE TABLE or ALTER TABLE statements

3. **Restore data (if backed up separately):**
   - Use `pg_dump` for data export (not included in this backup)
   - Use `pg_restore` to restore data

## Important Notes

⚠️ **This backup does NOT include:**
- User data (actual rows in tables)
- Sequences and current ID values
- Supabase Auth user records
- Storage bucket contents

✅ **This backup DOES include:**
- Complete schema structure
- All functions and their definitions
- All triggers and automation
- All views and their definitions
- Row Level Security policies (defined in migrations)

## Files Included

All migration files from `001` through `096` in the `/supabase/migrations/` directory represent the complete schema at this backup point.

### Key Migration Files

- **001-008:** Core schema setup (sites, users, units, budget, payments, ledger)
- **009-034:** Bug fixes and payment/dues logic refinements
- **035-067:** Multi-currency support, ledger fixes, balance calculations
- **068-077:** User management, registration, language support
- **078-079:** Translations and role permissions system
- **080-091:** Account initial exchange rates, dues functions improvements
- **092-096:** Opening balance function, force delete dues functionality

## Restoration Steps by Scenario

### Scenario A: "I just want to undo the last migration"

```sql
-- Option 1: In Supabase Dashboard SQL Editor
-- Find the function/table/view that was changed in migration 096
-- and manually run the previous version from migration 095

-- Option 2: Use migration system
-- (requires Supabase CLI)
supabase migration down
```

### Scenario B: "I want to go back to exactly this state"

```bash
# Using Supabase CLI
supabase db reset
supabase migration up --to 20260131072503
```

### Scenario C: "I just need one function restored"

1. Open the relevant migration file (e.g., `096_simplify_force_delete_dues_function.sql`)
2. Copy the `CREATE OR REPLACE FUNCTION` statement
3. Run it in Supabase SQL Editor

## Contact & Support

If you need help restoring from this backup:
1. Check the migration files in `/supabase/migrations/`
2. Review the `SCHEMA_REFERENCE.md` for table relationships
3. Check `REFACTORING_SUMMARY.md` for recent changes

---

**Backup Created By:** Database Backup System
**Last Known Good State:** Migration 096
**Next Migration:** (Not yet applied)
